if ($scheme != https) {
    return 301 https://$host$request_uri;
}
if ($server_port != 443) {
    return 301 https://$host$request_uri;
}
if ($ssl_protocol = "") {
    # return 301 https://$host$request_uri;
}

ssl_certificate /root/docker/data/cert/twbhub.com_top/cert.pem;
ssl_certificate_key /root/docker/data/cert/twbhub.com_top/key.pem;

ssl_session_cache shared:SSL:10m; #配置共享会话缓存大小
ssl_session_timeout 10m; #配置会话超时时间
ssl_prefer_server_ciphers on; #优先采取服务器算法
ssl_dhparam /root/docker/data/cert/twbhub.com_top/dhparam.pem; #使用D-H安全协议(迪菲-赫尔曼密钥交换)代替https 默认的SHA-1算法.(生成命令:openssl dhparam -out dhparam.pem 2048)
ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #协议版本
ssl_ciphers EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5; #定义算法

add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always; #启用HSTS;要求浏览器总是通过 https
add_header X-Frame-Options DENY; #减少点击劫持
add_header X-Content-Type-Options nosniff; #禁止服务器自动解析资源类型
add_header X-Xss-Protection 1; #防XSS攻击
add_header wall  "Hi! Welcome!";

set_real_ip_from 127.0.0.1; #从Proxy protocol获取真实IP
real_ip_header proxy_protocol;

#开启gzip压缩资源
gzip  on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_buffers 16 8k;
gzip_http_version 1.0;
gzip_min_length 100;
gzip_types text/plain text/css application/javascript application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/vnd.ms-fontobject application/x-font-ttf font/opentype image/svg+xml image/x-icon;
